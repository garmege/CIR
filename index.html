<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- meta -->
    <meta property="og:url" content="https://garmege.github.io/CIR/">
    <meta property="og:title" content="커스텀 인터벌 러닝">
    <meta property="og:type" content="website">
    <meta property="og:image" content="images/meta_image.png">
    <meta property="og:description" content="내가 쓰려고 만든 커스텀 인터벌 러닝 사이트">
    <link rel="apple-touch-icon" sizes="180x180" href="images/CIR_icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="images/favicon.png">
    <link rel="icon" type="image/png" sizes="16x16" href="images/favicon.png">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="theme-color" content="#ffffff">
    <title>커스텀 인터벌 러닝 페이지</title>
    <style>
        @import url("https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/variable/pretendardvariable-dynamic-subset.min.css");
        @import url('https://cdn.jsdelivr.net/npm/galmuri@latest/dist/galmuri.css');

        /*컬러 프리셋*/
        :root {
            --main-purple : #8934FF;
            --main-pink : #ff14bd;
            --sub-purple : #DCC5FF;
        }
        * {
            font-family: 'Galmuri9';
            box-sizing: border-box;
            font-size: 16px;
        }
        body {
            background-color: #090238;
            color: #fff;
        }
        h1.title {
            font-size: 32px;
            color: var(--main-pink);
        }
        .container {
            max-width: 600px;
            margin: 50px auto;
            text-align: center;
        }
        #intervals {
            display: flex;
            flex-wrap: wrap;
            width: 100%;
            margin-bottom: 20px;
            border-radius: 6px;
            border: 1px solid var(--sub-purple);
        }
        .interval {
            width: 100%;
            padding: 20px;
            display: flex;
            column-gap: 20px;
            align-items: center;
            justify-content: space-between;
        }

        .custom_box {
            width: 100%;
            display: flex;
            justify-content: space-between;
        }
        label {
            font-size: 14px;
            line-height: 22px;
            height: 40px;
        }
        input {
            width: 80px;
            height: 40px;
            background-color: transparent;
            border: 1px solid var(--main-purple);
            border-radius: 4px;
            color: #fff;
            text-align: center;
            font-size: 20px;
        }
        .btn_wrap {
            width: 100%;
            display: flex;
            justify-content: space-between;
            column-gap: 20px;
            margin-bottom: 10px;
        }
        .btn_wrap button {
            flex:1;
        }
        .btn_wrap button:hover, .btn_wrap button:active {
            box-shadow: inset -4px -4px 0px 0 rgba(0,0,0,0.2);
        }
        .btn_wrap button:hover span, .btn_wrap button:active span {
            position: relative;
            top: -4px;
            left: -4px;
        }
        button {
            line-height: 40px;
            border-radius: 6px;
            border: none;
            font-size: 16px;
            cursor: pointer;
        }
        #add_interval_btn {
            background-color: var(--main-pink);
            color: #fff;
        }
        #start_btn {
            background-color: var(--main-purple);
            color: #fff;
        }
        #myIntervalPlan {
            margin: 20px 0;
        }
        .plan {
            border: 1px solid var(--main-pink);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 10px;
        }
        .plan.running {
            background: linear-gradient(-45deg, var(--main-purple), var(--sub-purple), var(--main-purple), var(--main-purple), var(--main-pink));
            background-size: 400% 400%;
            animation: gradient 15s ease infinite;
        }
        @keyframes gradient {
            0% {
            background-position: 0% 50%;
            }
            50% {
            background-position: 100% 50%;
            }
            100% {
            background-position: 0% 50%;
            }
        }
        .plan.running .time {
            font-size: 28px;
            font-weight: 800;
            margin-top: 10px;
            display: block;
        }
        .total_interval_time {
            font-size: 20px;
            text-align: right;
        }
        #total_time {
            font-size: 20px;
            color: var(--main-pink);
        }
        @media screen and (max-width:430px){
            .btn_wrap {
                column-gap: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="title">커스텀 인터벌 러닝</h1>
        <div id="intervals">
            <div class="interval">
                <div class="custom_box">
                    <label for="speedInterval">속도<br>(km/h)</label>
                    <input type="number" id="speedInterval" inputmode="numeric">
                    <label for="timeInterval">시간<br>(분)</label>
                    <input type="number" id="timeInterval" inputmode="numeric">
                </div>
            </div>
        </div>
        <div id="myIntervalPlan">
              <!--인터벌 구간 추가 버튼을 누르면 custome_box에서 설정한 값이 plan 태그 하나씩 추가되어야 함 id는 추가한 순서대로 자동 부여되게-->
              <!--plan 태그에 running 클래스가 붙으면 시간(분) 의 시간이 00:00까지 카운트다운 되어야 함-->
              <!--00:00까지 카운트다운 되면 이 plan의 running 클래스는 제거. 다음 plan에 running 클래스가 붙고 카운트다운 또 시작 -->
              <!--마지막 plan의 시간(분) 도 00:00까지 카운트다운 되면 완성-->
        </div>
        <div class="btn_wrap">
            <button onclick="addInterval()" id="add_interval_btn"><span>PLAN ADD</span></button>
            <button onclick="startInterval()" id="start_btn"><span>START</span></button>
            <button onclick="resetPlans()" id="reset_btn" type="reset"><span>RESET</span></button>
        </div>
        <div class="total">
            <div class="total_interval_time">총 인터벌 시간 : <span id="total_time">00:00</span></div>
        </div>
    </div>
    <script>
        var intervals = []; // 사용자가 추가한 인터벌을 저장할 배열
        var currentIntervalIndex = 0; // 현재 진행 중인 인터벌의 인덱스
    
        // 인터벌 추가 함수
        function addInterval() {
            var speedInput = document.getElementById("speedInterval");
            var timeInput = document.getElementById("timeInterval");
    
            var speed = speedInput.value;
            var time = timeInput.value;
    
            // 입력값에 따라 시간 포맷 설정
            if (time >= 1 && time <= 9) {
                time = "0" + time + ":00";
            } else if (time >= 10) {
                time = time + ":00";
            } else {
                alert("올바른 시간을 입력하세요.");
                return;
            }
    
            if (speed === "" || time === "") {
                alert("속도와 시간을 입력하세요.");
                return;
            }
    
            var intervalsContainer = document.getElementById("myIntervalPlan");
            var newInterval = document.createElement("div");
            newInterval.classList.add("plan");
    
            // 추가된 인터벌의 속도와 시간 설정
            newInterval.innerHTML = `
                <span>${speed}</span> km/h <span class="time">${time}</span>
            `;
            intervalsContainer.appendChild(newInterval);
    
            // 입력된 인터벌을 배열에 추가
            intervals.push({speed: speed, time: time});
    
            //입력 시간 합산
            updateTotalTime();

            // 입력 필드 초기화
            speedInput.value = "";
            timeInput.value = "";
        }
        // 전체 시간 업데이트 함수
        function updateTotalTime() {
            var totalHours = 0;
            var totalMinutes = 0;

            // 모든 .plan .time 요소 선택
            var timeElements = document.querySelectorAll('.plan .time');

            // 각 .plan .time 요소에서 시간을 합산
            timeElements.forEach(function(timeElement) {
                var timeParts = timeElement.textContent.split(":");
                var hours = parseInt(timeParts[0]);
                var minutes = parseInt(timeParts[1]);

                totalHours += hours;
                totalMinutes += minutes;
            });

            // 분 단위가 60분을 넘어갈 경우 시간으로 환산
            totalHours += Math.floor(totalMinutes / 60);
            totalMinutes %= 60;

            // 시간 형식에 맞게 텍스트 설정
            var totalTimeText = (totalHours < 10 ? "0" + totalHours : totalHours) + ":" + (totalMinutes < 10 ? "0" + totalMinutes : totalMinutes);
            
            // #total_time 요소의 텍스트 업데이트
            document.getElementById("total_time").textContent = totalTimeText;
        }
        // 시작 버튼 클릭 시
        function startInterval() {
            // 인터벌이 추가되지 않은 경우
            if (intervals.length === 0) {
                alert("인터벌을 추가하세요.");
                return;
            }
    
            // 첫 번째 인터벌 시작
            startNextInterval();
        }
    
        // 다음 인터벌 시작 함수
        function startNextInterval() {
            // 현재 진행 중인 인터벌에 running 클래스 추가
            var currentInterval = document.getElementsByClassName("plan")[currentIntervalIndex];
            currentInterval.classList.add("running");
    
            // 현재 인터벌의 시간(분) 가져오기
            var timeSpan = currentInterval.querySelector(".time");
            var time = timeSpan.innerText;
            var [minutes, seconds] = time.split(":").map(Number);
    
            // 카운트다운 시작
            var timer = setInterval(function() {
                // 시간 감소
                seconds--;
                if (seconds < 0) {
                    seconds = 59;
                    minutes--;
                }
    
                // 시간 업데이트
                timeSpan.innerText = `${minutes.toString().padStart(2, "0")}:${seconds.toString().padStart(2, "0")}`;
    
                // 현재 인터벌 종료 조건 확인
                if (minutes === 0 && seconds === 0) {
                    clearInterval(timer);
                    currentIntervalIndex++; // 다음 인터벌로 인덱스 이동
                    currentInterval.classList.remove("running"); // 현재 인터벌에서 running 클래스 제거
    
                    // 모든 인터벌이 종료되었을 때
                    if (currentIntervalIndex === intervals.length) {
                        alert("인터벌이 종료되었습니다.");
                        return;
                    }
    
                    // 다음 인터벌 시작
                    startNextInterval();
                }
            }, 1000);
        }

        //인터벌 리셋 함수
        function resetPlans() {
            var plans = document.querySelectorAll('.plan');
            plans.forEach(function(plan) {
                plan.remove();
            });
            // #total_time 요소의 텍스트 업데이트
            document.getElementById("total_time").textContent = '00:00';
        }
    </script>
    
</body>
</html>